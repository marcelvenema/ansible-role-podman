---
#########################################################
## Set action                                          ##
#########################################################
# If action variable is not defined, gather status of the service
# If service not installed, set action to install. 
# If the service is not started, set action to start.

# Gather installed packages
- name: Gather installed packages...
  ansible.builtin.package_facts:
    manager: auto

# Gather service facts
- name: Gather service facts...
  ansible.builtin.service_facts:
  register: _service_facts

# Set action variable when service is not running
- name: Register variable (action)...
  ansible.builtin.set_fact:
    action: start
  when:
    - ( ('podman.socket' in ansible_facts.services) and (ansible_facts.services['podman.socket'].state is defined) and 
      (ansible_facts.services['podman.socket'].state != 'running') )

# Set action to install if podman is not installed
- name: Register variable (action)...
  ansible.builtin.set_fact:
    action: install
  when: "'podman' not in ansible_facts.packages"
